(function(b){b.rating=function(a,e){this.options=b.extend({fx:"float",image:"../img/stars.png",width:32,stars:5,minimal:0,titles:["\u0433\u043e\u043b\u043e\u0441","\u0433\u043e\u043b\u043e\u0441\u0430","\u0433\u043e\u043b\u043e\u0441\u043e\u0432"],readOnly:!1,url:"",type:"post",loader:"../img/ajax-loader.gif",click:function(){}},e||{});this.el=b(a);this.left=0;this.val=parseFloat(b(".val",a).val())||0;this.val>this.options.stars&&(this.val=this.options.stars);0>this.val&&(this.val=0);this.old=this.val;
this.votes=parseInt(b(".votes",a).val())||"";this.voteID=b(".vote-id",a).val()||"";this.vote_wrap=b('<div class="vote-wrap"></div>');this.vote_block=b('<div class="vote-block"></div>');this.vote_hover=b('<div class="vote-hover"></div>');this.vote_stars=b('<div class="vote-stars"></div>');this.vote_active=b('<div class="vote-active"></div>');this.vote_result=b('<div class="vote-result"></div>');this.vote_success=b('<div class="vote-success"></div>');this.loader=b('<img src="'+this.options.loader+'" alt="load...">');
this.init()};var d=b.rating;d.fn=d.prototype={rating:"0.1"};d.fn.extend=d.extend=b.extend;d.fn.extend({init:function(){this.render();if(!this.options.readOnly){var a=this,e=0,c=0;this.vote_hover.bind("mousemove mouseover",function(f){if(!a.options.readOnly){var d=b(this),g=0;e=0<f.clientX?f.clientX:f.pageX;c=e-d.offset().left-2;f=a.options.width*a.options.stars;d=a.options.minimal*a.options.width;c>f&&(c=f);c<d&&(c=d);"half"==a.options.fx?c=Math.ceil(c/a.options.width*2)*a.options.width/2:"float"!=
a.options.fx&&(c=Math.ceil(c/a.options.width)*a.options.width);g=Math.round(c/a.options.width*10)/10;a.vote_active.css({width:c,"background-position":"left center"});a.vote_success.html("\u0412\u0430\u0448\u0430 \u043e\u0446\u0435\u043d\u043a\u0430: "+g)}}).bind("mouseout",function(){a.options.readOnly||(a.reset(),a.vote_success.empty())}).bind("click.rating",function(){if(!a.options.readOnly){var b=Math.round(c/a.options.width*10)/10;b>a.options.stars&&(b=a.options.stars);0>b&&(b=0);a.old=a.val;
a.val=(a.val*a.votes+b)/(a.votes+1);a.val.toFixed(1);a.vote_success.html("\u0412\u0430\u0448\u0430 \u043e\u0446\u0435\u043d\u043a\u0430: "+b);""!=a.options.url&&a.send(b);a.options.readOnly=!0;a.options.click.apply(this,[b])}})}},set:function(){this.vote_active.css({width:this.val*this.options.width,"background-position":"left bottom"})},reset:function(){this.vote_active.css({width:this.old*this.options.width,"background-position":"left bottom"})},setvoters:function(){this.vote_result.html(this.declOfNum(this.votes))},
render:function(){this.el.html(this.vote_wrap.append(this.vote_hover.css({padding:"0 4px",height:this.options.width,width:this.options.width*this.options.stars}),this.vote_result.text(this.declOfNum(this.votes)),this.vote_success));this.vote_block.append(this.vote_stars.css({height:this.options.width,width:this.options.width*this.options.stars,background:"url('"+this.options.image+"') left top"}),this.vote_active.css({height:this.options.width,width:this.val*this.options.width,background:"url('"+
this.options.image+"') left bottom"})).appendTo(this.vote_hover)},send:function(a){this.vote_result.html(this.loader);this.votes++;this.set();this.setvoters();b.post("/raterHandler.php",{act:"vote_post",rating:a},function(d){b(".main_content .post_panel  .add_vote .vote_space").delay(2E3).slideUp(500,function(){b(".main_content .post_panel  .add_vote").text("\u0412\u0430\u0448\u0430 \u043e\u0446\u0435\u043d\u043a\u0430: "+a).css({cursor:"default"});b(".main_content .post_panel .starcover").css({width:16*
d})})})},declOfNum:function(a){if(0>=a)return"";a=Math.abs(Math.floor(a));cases=[2,0,1,1,1,2];return a+" "+this.options.titles[4<a%100&&20>a%100?2:cases[5>a%10?a%10:5]]}});b.fn.rating=function(a){if("string"==typeof a){var e=b(this).data("rating"),c=Array.prototype.slice.call(arguments,1);return e[a].apply(e,c)}return this.each(function(){var c=b(this).data("rating");c?(a&&b.extend(c.options,a),c.init()):b(this).data("rating",new d(this,a))})}})(jQuery);